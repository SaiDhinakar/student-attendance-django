{% extends 'attendance_dashboard/staff_base.html' %}
{% load static %}

{% block title %}Staff Dashboard - Attendance{% endblock %}

{% block content %}
  <!-- Advisor-Style Welcome Section -->
  <div class="advisor-welcome-section">
    <div class="flex items-center justify-between">
      <div>
        <h1>Welcome, {{ user.get_full_name|default:user.username }}!</h1>
        <p>Staff Attendance Dashboard - Manage and track attendance efficiently</p>
        <p class="text-sm mt-2 opacity-90">
          <i class="iconoir-calendar mr-1"></i>{{ "now"|date:"F d, Y" }} - 
          <i class="iconoir-clock mr-1"></i><span id="currentTime">Loading time...</span>
        </p>
      </div>
      <div class="hidden md:block">
        <i class="iconoir-user-star advisor-welcome-icon"></i>
      </div>
    </div>
  </div>

  <!-- Advisor-Style Stats Cards -->
  <div class="advisor-stats-grid">
    <!-- Total Classes Today -->
    <div class="advisor-stat-card">
      <div class="stat-icon" style="background: var(--gradient-primary);">
        <i class="iconoir-calendar"></i>
      </div>
      <div class="stat-title">Classes Today</div>
      <div class="stat-value">8</div>
    </div>

    <!-- Students Present -->
    <div class="advisor-stat-card">
      <div class="stat-icon" style="background: linear-gradient(135deg, #34d399 0%, #10b981 100%);">
        <i class="iconoir-check-circle"></i>
      </div>
      <div class="stat-title">Students Present</div>
      <div class="stat-value">245</div>
    </div>

    <!-- Attendance Taken -->
    <div class="advisor-stat-card">
      <div class="stat-icon" style="background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);">
        <i class="iconoir-camera"></i>
      </div>
      <div class="stat-title">Attendance Taken</div>
      <div class="stat-value">6/8</div>
    </div>

    <!-- Completion Rate -->
    <div class="advisor-stat-card">
      <div class="stat-icon" style="background: linear-gradient(135deg, #a855f7 0%, #9333ea 100%);">
        <i class="iconoir-stats-up"></i>
      </div>
      <div class="stat-title">Completion Rate</div>
      <div class="stat-value">75%</div>
    </div>
  </div>

  <!-- Advisor-Style Quick Actions -->
  <div class="advisor-actions-section">
    <h3>
      <i class="iconoir-fast-arrow-right"></i>Attendance Management
    </h3>
    <div class="advisor-actions-grid">
      <!-- Take Attendance -->
      <div class="advisor-action-card">
        <div class="advisor-action-icon" style="color: var(--primary);">
          <i class="iconoir-camera"></i>
        </div>
        <div class="advisor-action-title">Take Attendance</div>
        <div class="advisor-action-buttons">
          <a href="{% url 'attendance_dashboard:attendance' %}" class="advisor-action-btn primary">
            <i class="iconoir-camera"></i>Start Camera
          </a>
          <a href="{% url 'attendance_dashboard:manual_attendance' %}" class="advisor-action-btn secondary">
            <i class="iconoir-edit-pencil"></i>Manual Entry
          </a>
        </div>
      </div>

      <!-- View Reports -->
      <div class="advisor-action-card">
        <div class="advisor-action-icon" style="color: #10b981;">
          <i class="iconoir-stats-report"></i>
        </div>
        <div class="advisor-action-title">View Reports</div>
        <div class="advisor-action-buttons">
          <a href="{% url 'attendance_dashboard:reports' %}" class="advisor-action-btn success">
            <i class="iconoir-stats-report"></i>Generate Reports
          </a>
          <a href="{% url 'attendance_dashboard:analytics' %}" class="advisor-action-btn info">
            <i class="iconoir-graph-up"></i>Analytics
          </a>
        </div>
      </div>

      <!-- Attendance History -->
      <div class="advisor-action-card">
        <div class="advisor-action-icon" style="color: #f59e0b;">
          <i class="iconoir-history-backup"></i>
        </div>
        <div class="advisor-action-title">History & Records</div>
        <div class="advisor-action-buttons">
          <a href="{% url 'attendance_dashboard:history' %}" class="advisor-action-btn warning">
            <i class="iconoir-history-backup"></i>View History
          </a>
          <a href="{% url 'attendance_dashboard:corrections' %}" class="advisor-action-btn purple">
            <i class="iconoir-edit-pencil"></i>Make Corrections
          </a>
        </div>
      </div>

      <!-- Student Management -->
      <div class="advisor-action-card">
        <div class="advisor-action-icon" style="color: #a855f7;">
          <i class="iconoir-group"></i>
        </div>
        <div class="advisor-action-title">Student Management</div>
        <div class="advisor-action-buttons">
          <a href="{% url 'attendance_dashboard:student_list' %}" class="advisor-action-btn purple">
            <i class="iconoir-group"></i>View Students
          </a>
          <a href="{% url 'attendance_dashboard:attendance_summary' %}" class="advisor-action-btn primary">
            <i class="iconoir-stats-up"></i>Summary
          </a>
        </div>
      </div>
    </div>
  </div>

  <!-- Advisor-Style Information Panels -->
  <div class="advisor-info-grid">
    <!-- Today's Schedule -->
    <div class="advisor-info-panel">
      <h3>
        <i class="iconoir-calendar"></i>Today's Schedule
      </h3>
      <div class="space-y-2">
        <div class="advisor-info-item">
          <div class="advisor-info-label">9:00 AM - Computer Science 3rd Year</div>
          <div class="advisor-info-value success">✓ Completed</div>
        </div>
        <div class="advisor-info-item">
          <div class="advisor-info-label">11:00 AM - Electronics 2nd Year</div>
          <div class="advisor-info-value success">✓ Completed</div>
        </div>
        <div class="advisor-info-item">
          <div class="advisor-info-label">2:00 PM - Mechanical 1st Year</div>
          <div class="advisor-info-value warning">⏳ Pending</div>
        </div>
        <div class="advisor-info-item">
          <div class="advisor-info-label">3:30 PM - Civil Engineering</div>
          <div class="advisor-info-value warning">⏳ Pending</div>
        </div>
      </div>
    </div>

    <!-- Quick Statistics -->
    <div class="advisor-info-panel">
      <h3>
        <i class="iconoir-stats-up"></i>Quick Statistics
      </h3>
      <div class="space-y-2">
        <div class="advisor-info-item">
          <div class="advisor-info-label">This Week Average</div>
          <div class="advisor-info-value success">94.2%</div>
        </div>
        <div class="advisor-info-item">
          <div class="advisor-info-label">Total Students Today</div>
          <div class="advisor-info-value highlight">327</div>
        </div>
        <div class="advisor-info-item">
          <div class="advisor-info-label">Classes Completed</div>
          <div class="advisor-info-value highlight">6/8</div>
        </div>
        <div class="advisor-info-item">
          <div class="advisor-info-label">Low Attendance Alerts</div>
          <div class="advisor-info-value warning">2</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Advisor-Style Overview Cards -->
  <div class="advisor-overview-grid">
    <div class="advisor-overview-card">
      <h4>Recent Activity</h4>
      <div class="space-y-3 mt-3">
        <div class="flex items-center space-x-2">
          <div class="h-2 w-2 bg-green-500 rounded-full"></div>
          <p class="text-sm">CS 3rd Year attendance completed</p>
        </div>
        <div class="flex items-center space-x-2">
          <div class="h-2 w-2 bg-blue-500 rounded-full"></div>
          <p class="text-sm">Report generated for Electronics</p>
        </div>
        <div class="flex items-center space-x-2">
          <div class="h-2 w-2 bg-yellow-500 rounded-full"></div>
          <p class="text-sm">Alert sent for low attendance</p>
        </div>
      </div>
    </div>

    <div class="advisor-overview-card">
      <h4>Performance Metrics</h4>
      <p>Weekly completion: <span class="success">96.4%</span></p>
      <p>Average response time: <span class="highlight">2.3 minutes</span></p>
      <p>Error rate: <span class="success">0.1%</span></p>
      <p>Student satisfaction: <span class="success">4.8/5</span></p>
    </div>

    <div class="advisor-overview-card">
      <h4>Quick Actions</h4>
      <div class="space-y-2 mt-3">
        <a href="{% url 'attendance_dashboard:attendance' %}" class="btn-advisor-primary full-width">
          <i class="iconoir-camera"></i>Take Attendance
        </a>
        <a href="{% url 'attendance_dashboard:emergency_report' %}" class="btn-advisor-secondary full-width">
          <i class="iconoir-warning-triangle"></i>Emergency Report
        </a>
      </div>
    </div>
  </div>

  <!-- Enhanced Attendance Form Section -->
  <div class="advisor-actions-section">
    <h3>
      <i class="iconoir-camera"></i>Quick Attendance Capture
    </h3>
    <div class="mt-6">
      {% include 'shared/attendance_form.html' %}
    </div>
  </div>

  <!-- JavaScript for Real-time Clock -->
  <script>
    function updateTime() {
      const now = new Date();
      const timeString = now.toLocaleTimeString('en-US', {
        hour: '2-digit',
        minute: '2-digit',
        second: '2-digit',
        hour12: true
      });
      const timeElement = document.getElementById('currentTime');
      if (timeElement) {
        timeElement.textContent = timeString;
      }
    }
    
    // Update time immediately and then every second
    updateTime();
    setInterval(updateTime, 1000);
    
    // Auto-refresh stats every 30 seconds
    setInterval(function() {
      // Could add AJAX call here to update stats
    }, 30000);
  </script>

  <style>
    .full-width {
      width: 100%;
      justify-content: center;
    }
    
    /* Enhanced mobile responsiveness */
    @media (max-width: 768px) {
      .advisor-welcome-section h1 {
        font-size: 1.5rem;
      }
      
      .advisor-stat-card .stat-value {
        font-size: 1.5rem;
      }
      
      .advisor-action-icon {
        width: 3rem;
        height: 3rem;
        font-size: 1.5rem;
      }
    }
  </style>
{% endblock %}
